# Development Dockerfile for MP4SVG
FROM python:3.11-slim-bullseye

# Install system dependencies including dev tools
RUN apt-get update && apt-get install -y \
    libopencv-dev \
    python3-opencv \
    ffmpeg \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    curl \
    git \
    vim \
    nano \
    htop \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Install Poetry
RUN pip install poetry

# Configure Poetry for development
ENV POETRY_NO_INTERACTION=1 \
    POETRY_VENV_IN_PROJECT=1 \
    POETRY_CACHE_DIR=/tmp/poetry_cache

# Copy Poetry files
COPY pyproject.toml poetry.lock* ./

# Install all dependencies including dev
RUN poetry install && rm -rf $POETRY_CACHE_DIR

# Create non-root user for development
RUN useradd --create-home --shell /bin/bash --uid 1000 dev
RUN chown -R dev:dev /app

USER dev

# Default command opens shell for development
CMD ["/bin/bash"]
